
> [!notion] 
> * 持久化的方式之一
> * 通过在指定的时间间隔，对此时的数据集进行快照
> * RDB方法保存的文件是dump.rdb文件



> [!understand] 
> redis的数据是存储在内存中的，保存数据的时候是执行的**全量的快照**，也就是将内存中的所有的数据都写入到了磁盘的`dump.rdb`文件中。回复的时候，在将该文件重新读取到内存中。




> [!question] 如何检查修复dump.rdb文件
> 1. cd /usr/local/bin
> 2. 执行redis-check-rdb dump.rdb


> [!NOTE] RDB的常见配置
>* `save <second> <changes>`  
>*  `dbfilename`：dump文件的名称
>*  `dir`: dump文件所在的目录
>* `stop-writes-on-bgsave-error`： 如果配置成no，表示你不在乎数据不一致或者有其他的手段发现和控制这种不一致，那么在快照写入失败时，也能确保redis继续接受新的写请求
>* `rdbcompression`： 对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。  如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能
>* `rdbchecksum`：在存储快照后，还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗
>* `rdb-del-sync-files`： 在没有持久性的情况下删除复制中使用的RDB文件启用。默认情况下no，此选项是禁用的



> [!note]  什么情况下会触发RDB快照？
> 1. 触发配置文件中的快照的配置条件
> 2. 手动使用`save/bgave`
> 3. 执行`flushall/flushdb`命令也会产出`dump.rdb`文件，但是里面是空的
> 	![[CleanShot 2024-01-17 at 15.40.56@2x.png|775]]
> 4. 执行`shutdown`，并且没有开启[[redis_AOF|AOF]]持久化
> 5. 主从复制时，主节点自动触发




> [!note] 如何禁用快照
> 1. 使用命令：redis-cli config set save ”“
> 2. 修改配置文件
> 	![[CleanShot 2024-01-17 at 14.27.53@2x.png]]


> [!NOTE] 优缺点
> # 优点：
> 1. 适合大规模的数据恢复
> 2. 按照业务定时备份
> 3. 对于数据的完整性要求不高的时候，比较时候
> 4. RDB文件在内存中的加载速度要比AOF快很多
> # 缺点：
> 1. 在一定的时间内做一次备份，如果redis以外down掉的话，就会丢失从上一次快照，到最近 这段时间内的数据。
> 2. 内存数据全量同步，如果数据太大，会导致io影响服务器的性能。
> 3. RDB依赖于主进程的fork，在更大额数据集中，可能会导致服务器的请求延迟。


> [!example] 案例演示-自动备份

 1. 在配置文件中修改触发条件为10s两次修改
	![[CleanShot 2024-01-17 at 14.35.28@2x.png]]
2. 修改dump文件的保存路径,并且可以在redis中使用`config get dir`来获取目录
 	![[CleanShot 2024-01-17 at 14.47.40@2x.png|650]]
 3. 修改dump文件的名称
 	![[CleanShot 2024-01-17 at 14.37.48@2x.png|650]]
 4. 触发备份条件
		 * 方式1：10s内增加两个key
 		![[CleanShot 2024-01-17 at 15.26.55@2x.png|625]]
		 * 方式2： 
	 	![[CleanShot 2024-01-17 at 15.21.03@2x.png|525]]
 5. 从备份中恢复
	 * 将备份文件`dump.rdb`移动的到你所设置的目录中，并且启动服务
	 * 注意：**服务和备份一定要放在不同的机器上**



> [!example] 案例演示-手动备份
> 1. save:在主程序执行的过程中会阻塞当前的redis服务器，直到持久化的工作完成。也就是说在执行save命令的期间，redis不能处理其他的命令。线上*禁止使用该命令*
> 2. bgsave：会在后台fork出一个子进程来执行快照，不会阻塞。
> 	* lastave：通过该命令可以查看最后一次执行快照的时间
> 	![[CleanShot 2024-01-17 at 15.57.13@2x.png|700]]
